<% favorites = (current_user.try(:followed_teams) || []) %>
<div id="page-content-wrapper">
  <div class="container-fluid">
    <div class="sport_header row">
      <div class="col-md-12">
        <div class="sport_caption col-md-4 pull-right ">
          <h2 class="form-title">Favorite Teams</h2>
        </div>
      </div>
    </div>
    <div class="main-area">
      <div class="row">
        <div id='notice'>
          <%= render :partial => 'layouts/flash' , :locals => { :flash => flash } %>
        </div>
        <div class="follow">

					<div class="panel-body">
					  <% @teams.each do |team| %>
					  <table class="table">
					  	<tbody>
					  		<tr id = "<%=team.id%>">
					  			<td>
					    			<span><h4><%= link_to(team.name, team) %></h4></span>
					  			</td>
					  			<td > 
					  				<a href="#" class="subscribe-star <%= favorites.include?(team) ? 'fastar' : 'fastaro' %> team-<%= team.id %>" data-team-id='<%= team.id %>' data-team-name='<%= team.name %>'><%= favorites.include?(team) ? 'Un-favorite' : 'Favorite' %></a>
					  			</td>
					  		</tr>
					  	</tbody>
					  </table>
					  <% end %>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$('.subscribe-star').on('click', function() {
    var teamId = $(this).data('team-id');
    var teamName = $(this).data('team-name');
    var subscribed = $(this).hasClass('fastaro');
    console.log(teamId, teamName, subscribed)
    var url = '';
    if (subscribed) {
      url = "/teams/" + teamId + "/subscribe";
    } else {
      url = "/teams/" + teamId + "/unsubscribe";
    };
    // var div = $(this).closest('div').data('tab');
    var teamIdClass = '.team-' + teamId + '';
    $.ajax({
      url: url,
      type: 'PUT',
      data: {'id': teamId,
             'ajax': true},
      success: function() {
				alert("success");

        if ($(teamIdClass).hasClass('fastar')) {
					alert("making Un-favorite");
          var teamRow = $('#' + teamId);
          $(teamIdClass).removeClass('fastar');
          $(teamIdClass).addClass('fastaro');
          $(teamIdClass).text('Favorite');
          teamRow.addClass('hidden');
          displayMessage("The " + teamName + " are no longer a favorite")
        } else {
          var teamRow = $('div.followed.' + teamId);
          var sportRow = $('div.followed.' + sportName);
          sportRow.removeClass('hidden');
          teamRow.removeClass('hidden');
          $(teamIdClass).removeClass('fastaro');
          $(teamIdClass).addClass('fastar');
          $(teamIdClass).text('Un-favorite');     
          displayMessage("The " + teamName + " are now a favorite")
        };
      },
      error: function(){
        //do nothing
      }
    })
  });
</script>